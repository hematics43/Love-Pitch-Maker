<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Love Pitch Visualizer ‚Äì 10 Graphs</title>
  <style>
    body {
      background: linear-gradient(to bottom right, #ffe4ec, #fddde6);
      color: #b30059;
      font-family: 'Segoe UI', sans-serif;
      text-align: center;
      padding: 20px;
    }
    h1 { font-size: 2.5em; margin-bottom: 10px; }
    #freq { font-size: 2em; margin: 10px; color: #e60073; }
    button {
      margin: 5px; padding: 10px 20px; background: #ff4da6; 
      border: none; border-radius: 25px; color: white; 
      font-size: 1em; cursor: pointer; box-shadow: 0 4px 8px #ff80bf;
    }
    .canvas {
      border: 2px solid #ff99cc; border-radius: 10px; 
      background: #fff0f5; margin: 10px auto; display: block;
    }
    #savedList {
      max-height: 120px; overflow-y: auto; padding: 10px; 
      border: 2px dashed #ff66a3; background: #fff0f5; 
      font-size: 1.1em; margin: 10px auto; width: 90%;
    }
    input[type="text"] {
      padding: 10px; font-size: 1em; border-radius: 8px; 
      border: 1px solid #ff66a3; width: 220px;
    }
  </style>
</head>
<body>
  <h1>üíï Love Pitch Visualizer üíï</h1>
  <div id="freq">Waiting for love...</div>
  <button onclick="savePitch()">üìÇ Save Pitch</button>
  <button onclick="saveWaveform()">üñºÔ∏è Save Waveform</button>
  <input type="text" id="ttfText" placeholder="Enter text‚Ä¶" />
  <button onclick="textToFreq()">üîê Text ‚Üí Graph</button>
  <div id="savedList">Saved Frequencies: None</div>

  <!-- 10 Canvas Graphs -->
  <canvas id="c1" class="canvas" width="600" height="120"></canvas>
  <canvas id="c2" class="canvas" width="600" height="120"></canvas>
  <canvas id="c3" class="canvas" width="600" height="120"></canvas>
  <canvas id="c4" class="canvas" width="600" height="120"></canvas>
  <canvas id="c5" class="canvas" width="600" height="120"></canvas>
  <canvas id="c6" class="canvas" width="600" height="120"></canvas>
  <canvas id="c7" class="canvas" width="600" height="120"></canvas>
  <canvas id="c8" class="canvas" width="600" height="120"></canvas>
  <canvas id="c9" class="canvas" width="600" height="120"></canvas>
  <canvas id="c10" class="canvas" width="600" height="120"></canvas>

<script>
let audioCtx, source, analyserWF, analyserSpec, dataWF, dataSpec;
let latestFreq = -1, saved = [], noteCounts = {};

function savePitch() {
  if (latestFreq > 0) {
    saved.push(latestFreq.toFixed(2));
    const note = freqToNote(latestFreq);
    noteCounts[note] = (noteCounts[note] || 0) + 1;
    updateSavedList(); drawGraph3(); drawGraph9();
  }
}
function saveWaveform() {
  const a = document.createElement('a');
  a.download = `wave_${Date.now()}.png`;
  a.href = document.getElementById('c1').toDataURL();
  a.click();
}
function updateSavedList() {
  document.getElementById('savedList').innerHTML = saved.length ?
    saved.map(f => `${f} Hz (${freqToNote(parseFloat(f))})`).join('<br>') : 'None';
}
function freqToNote(freq) {
  const A4 = 440, notes = ["C","C‚ôØ","D","D‚ôØ","E","F","F‚ôØ","G","G‚ôØ","A","A‚ôØ","B"];
  const n = Math.round(12 * Math.log2(freq / A4)) + 69;
  const note = notes[(n % 12 + 12) % 12], octave = Math.floor(n / 12) - 1;
  return note + octave;
}

async function startAudio() {
  const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
  audioCtx = new (window.AudioContext || webkitAudioContext)();
  source = audioCtx.createMediaStreamSource(stream);

  analyserWF = audioCtx.createAnalyser(); analyserWF.fftSize = 1024;
  analyserSpec = audioCtx.createAnalyser(); analyserSpec.fftSize = 256;
  source.connect(analyserWF); source.connect(analyserSpec);
  dataWF = new Float32Array(analyserWF.fftSize);
  dataSpec = new Uint8Array(analyserSpec.frequencyBinCount);

  requestAnimationFrame(update);
}
function drawGraph1() {
  analyserWF.getFloatTimeDomainData(dataWF);
  const c = document.getElementById('c1'), ctx = c.getContext('2d');
  ctx.clearRect(0, 0, c.width, c.height);
  ctx.beginPath(); ctx.strokeStyle = "#e60073"; ctx.lineWidth = 1.5;
  let x = 0, slice = c.width / dataWF.length;
  dataWF.forEach((v, i) => {
    const y = (v * 0.5 + 0.5) * c.height;
    i == 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
    x += slice;
  }); ctx.stroke();
}
function drawGraph2() {
  analyserSpec.getByteFrequencyData(dataSpec);
  const c = document.getElementById('c2'), ctx = c.getContext('2d');
  ctx.clearRect(0, 0, c.width, c.height);
  dataSpec.forEach((v, i) => {
    ctx.fillStyle = `hsl(${i * 4}, 100%, 75%)`;
    const h = v * c.height / 255;
    ctx.fillRect(i * (c.width / dataSpec.length), c.height - h, (c.width / dataSpec.length) - 1, h);
  });
}
function drawGraph3() {
  const c = document.getElementById('c3'), ctx = c.getContext('2d');
  ctx.clearRect(0, 0, c.width, c.height);
  if (saved.length < 2) return;
  ctx.beginPath(); ctx.strokeStyle = "#cc0066"; ctx.lineWidth = 2;
  saved.forEach((f, i) => {
    const x = i * (c.width / (saved.length - 1));
    const y = c.height - (f / 1000) * c.height;
    i == 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
  }); ctx.stroke();
}
function drawGraph4() {
  const c = document.getElementById('c4'), ctx = c.getContext('2d');
  ctx.clearRect(0, 0, c.width, c.height);
  const notes = Object.keys(noteCounts), total = saved.length;
  notes.forEach((n, i) => {
    const h = noteCounts[n] / total * c.height;
    ctx.fillStyle = "#ff66b2";
    ctx.fillRect(i * (c.width / notes.length), c.height - h, (c.width / notes.length) - 1, h);
    ctx.fillStyle = "#cc0066"; ctx.fillText(n, i * (c.width / notes.length) + 4, c.height - 5);
  });
}
function drawGraph5() {
  const c = document.getElementById('c5'), ctx = c.getContext('2d');
  ctx.clearRect(0, 0, c.width, c.height);
  ctx.strokeStyle = '#ff3399';
  ctx.beginPath(); ctx.moveTo(0, c.height/2);
  ctx.lineTo(c.width, c.height/2); ctx.stroke();
}
function drawGraph6(){ drawGraph1(); }
function drawGraph7(){ drawGraph2(); }
function drawGraph8(){ drawGraph3(); }
function drawGraph9(){ drawGraph4(); }
function drawGraph10(){
  const c=document.getElementById('c10'), ctx=c.getContext('2d');
  ctx.clearRect(0,0,c.width,c.height);
  ctx.fillStyle="#cc0066";
  ctx.font="16px sans-serif";
  ctx.fillText(`Saved: ${saved.length}`,10,20);
  if(latestFreq>0) ctx.fillText(`Last: ${latestFreq.toFixed(2)} Hz`,10,40);
}

function update() {
  analyserWF.getFloatTimeDomainData(dataWF);
  const freq = autocorr(dataWF, audioCtx.sampleRate);
  latestFreq = freq > 0 ? freq : -1;
  document.getElementById('freq').textContent = latestFreq > 0 ? `‚ù§Ô∏è ${latestFreq.toFixed(2)} Hz (${freqToNote(latestFreq)})` : 'Waiting for love...';
  drawGraph1(); drawGraph2(); drawGraph5(); drawGraph10();
  requestAnimationFrame(update);
}
function autocorr(buf, sr) {
  let SIZE = buf.length, MAX = SIZE / 2, bestOff = -1, bestCorr = 0, rms = 0;
  for (let i = 0; i < SIZE; i++) rms += buf[i] * buf[i];
  rms = Math.sqrt(rms / SIZE);
  if (rms < 0.01) return -1;
  let lastCorr = 1;
  for (let off = 0; off < MAX; off++) {
    let corr = 0;
    for (let i = 0; i < MAX; i++) corr += Math.abs(buf[i] - buf[i + off]);
    corr = 1 - (corr / MAX);
    if (corr > 0.9 && corr > lastCorr) { bestCorr = corr; bestOff = off; }
    lastCorr = corr;
  }
  return bestCorr > 0.01 ? sr / bestOff : -1;
}
function textToFreq() {
  const text = document.getElementById('ttfText').value;
  saved.length = 0; for (let k in noteCounts) delete noteCounts[k];
  text.split('').forEach(ch => {
    const code = ch.charCodeAt(0);
    const f = 220 + (code % 100) * 3;
    saved.push(f);
    const n = freqToNote(f); noteCounts[n] = (noteCounts[n] || 0) + 1;
  });
  updateSavedList(); drawGraph3(); drawGraph4(); drawGraph10();
}

startAudio().catch(() => alert('Mic blocked or unsupported'));
</script>
</body>
</html>
